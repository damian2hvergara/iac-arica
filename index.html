<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="description" content="Camionetas americanas importadas desde USA. Silverado, RAM, F-150 en Arica, Chile. Reserva con 10-30% del valor.">
<title>Import American Cars ‚Äî Arica, Chile</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@600;700;800&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<!-- Google Analytics 4 -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-83095XZ965"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-83095XZ965');
</script>

<style>
/* ============================================
   TOKENS
   ============================================ */
:root {
  --red:       #9B0000;
  --red-deep:  #6B0000;
  --red-glow:  rgba(155,0,0,0.22);
  --bg:        #0C0C0C;
  --surface:   #161616;
  --surface-2: #202020;
  --surface-3: #2A2A2A;
  --border:    rgba(255,255,255,0.08);
  --border-hi: rgba(255,255,255,0.14);
  --text:      #F2F2F2;
  --muted:     #6E6E6E;
  --muted-2:   #3E3E3E;
  --green:     #00C566;
  --blue:      #3B82F6;
  --orange:    #F59E0B;
  --white:     #FFFFFF;

  --font-h:    'Barlow Condensed', sans-serif;
  --font-b:    'DM Sans', sans-serif;

  --r-sm:   10px;
  --r-md:   16px;
  --r-lg:   22px;
  --r-full: 999px;
}

/* ============================================
   RESET
   ============================================ */
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth;-webkit-font-smoothing:antialiased}
body{font-family:var(--font-b);background:var(--bg);color:var(--text);font-size:15px;line-height:1.55;overflow-x:hidden}
a{color:inherit;text-decoration:none}
img{display:block;max-width:100%}
button{font-family:inherit;cursor:pointer;border:none;background:none}

/* ============================================
   TOPBAR
   ============================================ */
.topbar{
  position:fixed;top:0;left:0;right:0;z-index:900;
  height:52px;
  display:flex;align-items:center;justify-content:space-between;
  padding:0 18px;
  background:rgba(12,12,12,0.85);
  backdrop-filter:blur(20px);
  border-bottom:1px solid var(--border);
}
.topbar-logo{
  font-family:var(--font-h);
  font-size:19px;letter-spacing:0.5px;
  color:var(--white);
}
.topbar-logo span{color:var(--red);}
.topbar-wa{
  display:flex;align-items:center;gap:7px;
  padding:8px 16px;
  background:var(--red);
  color:var(--white);
  border-radius:var(--r-full);
  font-size:13px;font-weight:600;
  transition:background 0.2s;
}
.topbar-wa:active{background:var(--red-deep);}

/* ============================================
   HERO
   ============================================ */
.hero{
  position:relative;
  margin-top:52px;
  min-height:calc(100svh - 52px);
  display:flex;flex-direction:column;justify-content:flex-end;
  overflow:hidden;
}
.hero-bg{
  position:absolute;inset:0;
  background-image:url('https://res.cloudinary.com/df2gprqhp/image/upload/v1765988412/CHEVROLET_yjwbxt.jpg');
  background-size:cover;background-position:center 30%;
  filter:brightness(0.38) saturate(1.1);
  transform:scale(1.04);
  animation:bgZoom 8s ease-out forwards;
}
@keyframes bgZoom{to{transform:scale(1);}}
.hero-gradient{
  position:absolute;inset:0;
  background:linear-gradient(to top,rgba(12,12,12,1) 0%,rgba(12,12,12,0.55) 45%,transparent 100%);
}
.hero-content{
  position:relative;z-index:1;
  padding:0 20px 36px;
  animation:fadeUp 0.9s 0.3s both;
}
@keyframes fadeUp{from{opacity:0;transform:translateY(22px)}to{opacity:1;transform:translateY(0)}}
.hero-eyebrow{
  display:inline-flex;align-items:center;gap:7px;
  background:var(--red);
  color:var(--white);
  font-size:11px;font-weight:700;letter-spacing:1.2px;text-transform:uppercase;
  padding:5px 12px;border-radius:var(--r-full);
  margin-bottom:14px;
}
.hero-title{
  font-family:var(--font-h);
  font-size:clamp(38px,10vw,58px);
  font-weight:800;line-height:1;letter-spacing:-0.5px;
  color:var(--white);
  margin-bottom:12px;
}
.hero-title em{color:var(--red);font-style:normal;}
.hero-sub{
  font-size:15px;color:rgba(255,255,255,0.72);
  margin-bottom:26px;max-width:340px;line-height:1.5;
}
.hero-stats{
  display:flex;gap:10px;margin-bottom:26px;
  flex-wrap:wrap;
}
.stat-pill{
  display:flex;align-items:center;gap:7px;
  background:rgba(255,255,255,0.09);
  backdrop-filter:blur(10px);
  border:1px solid rgba(255,255,255,0.12);
  border-radius:var(--r-full);
  padding:7px 14px;
  font-size:13px;
  cursor:pointer;
  transition:background 0.2s;
}
.stat-pill:active{background:rgba(255,255,255,0.15);}
.stat-pill .dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;}
.dot-green{background:var(--green);}
.dot-blue{background:var(--blue);}
.dot-orange{background:var(--orange);}
.stat-pill strong{font-weight:700;}
.hero-cta{
  display:flex;align-items:center;gap:10px;
}
.btn-primary{
  flex:1;
  display:flex;align-items:center;justify-content:center;gap:9px;
  background:var(--red);
  color:var(--white);
  font-size:15px;font-weight:600;
  padding:15px 20px;
  border-radius:var(--r-md);
  transition:background 0.2s, transform 0.15s;
  -webkit-tap-highlight-color:transparent;
}
.btn-primary:active{background:var(--red-deep);transform:scale(0.98);}
.btn-secondary{
  display:flex;align-items:center;justify-content:center;gap:9px;
  background:var(--surface-2);
  color:var(--text);
  font-size:15px;font-weight:500;
  padding:15px 18px;
  border-radius:var(--r-md);
  border:1px solid var(--border-hi);
  transition:background 0.2s;
}
.btn-secondary:active{background:var(--surface-3);}

/* ============================================
   SECCI√ìN: CONFIANZA (debajo del hero, antes de veh√≠culos)
   ============================================ */
.trust-bar{
  background:var(--surface);
  border-bottom:1px solid var(--border);
  padding:22px 20px;
}
.trust-bar-inner{
  display:flex;gap:20px;overflow-x:auto;-webkit-overflow-scrolling:touch;
  scrollbar-width:none;padding-bottom:2px;
}
.trust-bar-inner::-webkit-scrollbar{display:none;}
.trust-item{
  display:flex;align-items:center;gap:10px;
  flex-shrink:0;
  font-size:13px;color:var(--muted);
  white-space:nowrap;
}
.trust-item i{color:var(--red);font-size:16px;}
.trust-item strong{color:var(--text);}

/* ============================================
   SECCI√ìN COM√öN
   ============================================ */
.section{padding:52px 20px;}
.section-label{
  font-size:11px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;
  color:var(--red);margin-bottom:8px;
}
.section-title{
  font-family:var(--font-h);
  font-size:clamp(28px,7vw,38px);
  font-weight:800;letter-spacing:-0.3px;line-height:1.05;
  color:var(--white);margin-bottom:10px;
}
.section-sub{
  font-size:14px;color:var(--muted);line-height:1.6;
  max-width:380px;margin-bottom:28px;
}

/* ============================================
   FILTROS VEH√çCULOS
   ============================================ */
.filter-scroll{
  display:flex;gap:8px;overflow-x:auto;-webkit-overflow-scrolling:touch;
  scrollbar-width:none;margin-bottom:22px;padding-bottom:2px;
}
.filter-scroll::-webkit-scrollbar{display:none;}
.filter-chip{
  flex-shrink:0;
  display:flex;align-items:center;gap:6px;
  padding:8px 16px;
  border-radius:var(--r-full);
  font-size:13px;font-weight:500;
  color:var(--muted);
  background:var(--surface-2);
  border:1px solid var(--border);
  transition:all 0.2s;
  cursor:pointer;
  -webkit-tap-highlight-color:transparent;
}
.filter-chip.active{
  background:var(--red);
  color:var(--white);
  border-color:var(--red);
}
.filter-chip .fc-dot{width:7px;height:7px;border-radius:50%;}

/* ============================================
   GRID VEH√çCULOS
   ============================================ */
.vehicles-grid{
  display:flex;flex-direction:column;gap:16px;
}
.vehicle-card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--r-lg);
  overflow:hidden;
  transition:border-color 0.2s;
  -webkit-tap-highlight-color:transparent;
}
.vehicle-card:active{border-color:var(--border-hi);}
.vc-image-wrap{
  position:relative;
  aspect-ratio:16/9;
  background:var(--surface-2);
  overflow:hidden;
  cursor:pointer;
}
.vc-image-wrap img{
  width:100%;height:100%;object-fit:cover;
  transition:transform 0.4s ease;
}
.vc-image-wrap:active img{transform:scale(1.03);}
.vc-status{
  position:absolute;top:12px;left:12px;
  display:inline-flex;align-items:center;gap:5px;
  padding:5px 11px;border-radius:var(--r-full);
  font-size:11px;font-weight:700;letter-spacing:0.3px;
  backdrop-filter:blur(12px);
}
.vc-status-stock{background:rgba(0,197,102,0.18);color:#00C566;border:1px solid rgba(0,197,102,0.3);}
.vc-status-transit{background:rgba(59,130,246,0.18);color:#60A5FA;border:1px solid rgba(59,130,246,0.3);}
.vc-status-reserve{background:rgba(245,158,11,0.18);color:#FBBF24;border:1px solid rgba(245,158,11,0.3);}
.vc-share{
  position:absolute;top:12px;right:12px;
  width:36px;height:36px;border-radius:50%;
  background:rgba(0,0,0,0.5);backdrop-filter:blur(8px);
  color:rgba(255,255,255,0.85);
  display:flex;align-items:center;justify-content:center;
  font-size:14px;
  border:1px solid rgba(255,255,255,0.15);
  transition:background 0.2s;
}
.vc-share:active{background:rgba(155,0,0,0.7);}
.vc-gallery-hint{
  position:absolute;bottom:10px;right:12px;
  font-size:11px;color:rgba(255,255,255,0.7);
  display:flex;align-items:center;gap:4px;
  background:rgba(0,0,0,0.5);backdrop-filter:blur(6px);
  padding:4px 9px;border-radius:var(--r-full);
  pointer-events:none;
}
.vc-body{padding:16px 16px 18px;}
.vc-name{
  font-family:var(--font-h);
  font-size:22px;font-weight:700;line-height:1;
  color:var(--white);margin-bottom:4px;
}
.vc-price{
  font-size:21px;font-weight:700;
  color:var(--white);margin-bottom:12px;
}
.vc-price span{font-size:13px;font-weight:400;color:var(--muted);margin-left:2px;}
.vc-meta{
  display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px;
}
.vc-tag{
  display:flex;align-items:center;gap:5px;
  font-size:12px;color:var(--muted);
  background:var(--surface-2);
  padding:4px 10px;border-radius:var(--r-full);
  border:1px solid var(--border);
}
.vc-actions{
  display:grid;grid-template-columns:1fr 1fr;gap:8px;
}
.vc-btn-main{
  display:flex;align-items:center;justify-content:center;gap:7px;
  background:var(--red);color:var(--white);
  font-size:14px;font-weight:600;
  padding:13px 10px;
  border-radius:var(--r-md);
  transition:background 0.2s;
  -webkit-tap-highlight-color:transparent;
}
.vc-btn-main:active{background:var(--red-deep);}
.vc-btn-ghost{
  display:flex;align-items:center;justify-content:center;gap:7px;
  background:var(--surface-2);color:var(--text);
  font-size:14px;font-weight:500;
  padding:13px 10px;
  border-radius:var(--r-md);
  border:1px solid var(--border);
  transition:background 0.2s;
  -webkit-tap-highlight-color:transparent;
}
.vc-btn-ghost:active{background:var(--surface-3);}

/* transit timer */
.transit-pill{
  display:flex;align-items:center;gap:7px;
  margin-bottom:12px;
  padding:8px 12px;
  background:rgba(59,130,246,0.1);
  border:1px solid rgba(59,130,246,0.2);
  border-radius:var(--r-md);
  font-size:12px;color:#60A5FA;
}
.transit-pill i{flex-shrink:0;}

/* LOADING */
.loading-state{
  display:flex;flex-direction:column;align-items:center;
  padding:60px 20px;gap:14px;color:var(--muted);font-size:14px;
}
.spin{
  width:36px;height:36px;
  border:3px solid var(--surface-3);
  border-top-color:var(--red);
  border-radius:50%;
  animation:spin 0.75s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

/* EMPTY STATE */
.empty-state{
  text-align:center;padding:60px 20px;
  color:var(--muted);
}
.empty-state i{font-size:40px;margin-bottom:14px;opacity:0.3;}
.empty-state h3{font-size:18px;color:var(--text);margin-bottom:6px;}

/* ============================================
   SECCI√ìN: PROCESO (video Instagram)
   ============================================ */
.proceso-section{
  background:var(--surface);
  border-top:1px solid var(--border);
  border-bottom:1px solid var(--border);
  padding:52px 20px;
}
.proceso-steps{
  display:flex;flex-direction:column;gap:0;
  margin-bottom:32px;
  position:relative;
}
.proceso-steps::before{
  content:'';
  position:absolute;left:18px;top:24px;bottom:24px;
  width:2px;background:linear-gradient(to bottom,var(--red),var(--red-deep));
  opacity:0.4;
}
.proceso-step{
  display:flex;align-items:flex-start;gap:16px;
  padding:16px 0;
}
.step-num{
  flex-shrink:0;
  width:36px;height:36px;border-radius:50%;
  background:var(--surface-2);
  border:2px solid var(--red);
  display:flex;align-items:center;justify-content:center;
  font-family:var(--font-h);font-size:16px;font-weight:700;
  color:var(--red);
  z-index:1;
}
.step-text h4{font-size:15px;font-weight:600;color:var(--white);margin-bottom:3px;}
.step-text p{font-size:13px;color:var(--muted);line-height:1.5;}

/* Video Instagram */
.ig-video-wrap{
  border-radius:var(--r-lg);
  overflow:hidden;
  border:1px solid var(--border);
  background:var(--surface-2);
  margin-bottom:24px;
}
.ig-video-placeholder{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  padding:40px 20px;gap:12px;
  text-align:center;
}
.ig-play-btn{
  width:64px;height:64px;border-radius:50%;
  background:linear-gradient(135deg,#833ab4,#fd1d1d,#fcb045);
  display:flex;align-items:center;justify-content:center;
  font-size:24px;color:white;
  box-shadow:0 8px 24px rgba(131,58,180,0.4);
}
.ig-video-label{font-size:15px;font-weight:600;color:var(--white);}
.ig-video-sub{font-size:12px;color:var(--muted);}
.ig-open-btn{
  display:flex;align-items:center;justify-content:center;gap:8px;
  width:100%;padding:14px;
  background:linear-gradient(135deg,#833ab4,#fd1d1d);
  color:white;font-size:14px;font-weight:600;
  border-radius:var(--r-md);
  transition:opacity 0.2s;
}
.ig-open-btn:active{opacity:0.85;}

/* ============================================
   SECCI√ìN: TESTIMONIOS
   ============================================ */
.testimonios-scroll{
  display:flex;gap:12px;
  overflow-x:auto;-webkit-overflow-scrolling:touch;
  scrollbar-width:none;
  margin:0 -20px;padding:0 20px 4px;
}
.testimonios-scroll::-webkit-scrollbar{display:none;}
.testimonio-card{
  flex-shrink:0;width:280px;
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--r-lg);
  padding:18px;
}
.test-avatar{
  width:44px;height:44px;border-radius:50%;
  object-fit:cover;margin-bottom:12px;
  border:2px solid var(--surface-3);
}
.test-stars{color:#FBBF24;font-size:13px;margin-bottom:8px;letter-spacing:1px;}
.test-quote{
  font-size:14px;color:var(--text);
  line-height:1.55;margin-bottom:12px;
  font-style:italic;
}
.test-author{font-size:12px;font-weight:600;color:var(--white);}
.test-vehicle{font-size:11px;color:var(--muted);margin-top:2px;}

/* ============================================
   SECCI√ìN: INSTAGRAM GRID
   ============================================ */
.ig-grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:8px;
}
.ig-post{
  position:relative;
  aspect-ratio:1;
  border-radius:var(--r-sm);
  overflow:hidden;
  background:var(--surface-2);
  cursor:pointer;
}
.ig-post img{width:100%;height:100%;object-fit:cover;transition:transform 0.3s;}
.ig-post:active img{transform:scale(1.05);}
.ig-post-overlay{
  position:absolute;inset:0;
  background:rgba(0,0,0,0.35);
  display:flex;align-items:center;justify-content:center;
  opacity:0;transition:opacity 0.2s;
}
.ig-post:active .ig-post-overlay{opacity:1;}
.ig-post-overlay i{font-size:24px;color:white;}

/* ============================================
   CTA FINAL (antes del footer)
   ============================================ */
.final-cta{
  background:linear-gradient(135deg,var(--red-deep) 0%,var(--red) 100%);
  padding:48px 20px;
  text-align:center;
}
.final-cta h2{
  font-family:var(--font-h);
  font-size:clamp(30px,8vw,44px);font-weight:800;
  color:var(--white);margin-bottom:10px;line-height:1.05;
}
.final-cta p{
  font-size:14px;color:rgba(255,255,255,0.8);
  margin-bottom:28px;line-height:1.6;
}
.final-cta-btn{
  display:inline-flex;align-items:center;justify-content:center;gap:10px;
  background:var(--white);
  color:var(--red);
  font-size:16px;font-weight:700;
  padding:16px 32px;
  border-radius:var(--r-md);
  width:100%;max-width:360px;
  transition:opacity 0.2s;
  -webkit-tap-highlight-color:transparent;
}
.final-cta-btn:active{opacity:0.88;}

/* ============================================
   FOOTER
   ============================================ */
.footer{
  background:var(--surface);
  border-top:1px solid var(--border);
  padding:36px 20px calc(36px + env(safe-area-inset-bottom));
  text-align:center;
}
.footer-logo{
  font-family:var(--font-h);font-size:20px;font-weight:800;
  color:var(--white);margin-bottom:6px;
}
.footer-logo span{color:var(--red);}
.footer-info{
  font-size:12px;color:var(--muted);line-height:1.8;
  margin-bottom:20px;
}
.footer-social{
  display:flex;justify-content:center;gap:16px;
}
.social-link{
  width:40px;height:40px;border-radius:50%;
  background:var(--surface-2);border:1px solid var(--border);
  display:flex;align-items:center;justify-content:center;
  font-size:16px;color:var(--muted);
  transition:all 0.2s;
}
.social-link:active{background:var(--red);color:var(--white);border-color:var(--red);}

/* ============================================
   WA STICKY BOTTOM
   ============================================ */
.wa-sticky{
  position:fixed;bottom:0;left:0;right:0;
  z-index:800;
  padding:12px 16px calc(12px + env(safe-area-inset-bottom));
  background:linear-gradient(to top,rgba(12,12,12,1) 0%,rgba(12,12,12,0.9) 60%,transparent 100%);
  pointer-events:none;
  display:none;
}
.wa-sticky.visible{display:block;}
.wa-sticky-btn{
  pointer-events:all;
  display:flex;align-items:center;justify-content:center;gap:10px;
  background:#25D366;
  color:white;
  font-size:15px;font-weight:700;
  padding:15px 24px;
  border-radius:var(--r-md);
  width:100%;
  box-shadow:0 4px 24px rgba(37,211,102,0.35);
  transition:opacity 0.2s;
  -webkit-tap-highlight-color:transparent;
}
.wa-sticky-btn:active{opacity:0.88;}

/* ============================================
   MODALES
   ============================================ */
.modal{
  display:none;position:fixed;inset:0;z-index:1000;
  overflow-y:auto;
}
.modal.active{display:block;}
.modal-overlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,0.85);
  backdrop-filter:blur(6px);
}
.modal-sheet{
  position:relative;
  background:var(--surface);
  margin:auto;
  margin-top:60px;
  margin-bottom:20px;
  width:calc(100% - 24px);
  max-width:640px;
  border-radius:var(--r-lg);
  border:1px solid var(--border);
  animation:sheetUp 0.32s cubic-bezier(0.22,1,0.36,1) both;
  overflow:hidden;
}
@keyframes sheetUp{from{opacity:0;transform:translateY(32px)}to{opacity:1;transform:none}}
.modal-close-btn{
  position:absolute;top:14px;right:14px;z-index:5;
  width:32px;height:32px;border-radius:50%;
  background:var(--surface-3);
  color:var(--muted);
  display:flex;align-items:center;justify-content:center;
  font-size:16px;
  transition:background 0.2s;
}
.modal-close-btn:active{background:var(--surface-2);}

/* DETALLE MODAL */
.detail-hero{
  position:relative;
  aspect-ratio:16/9;background:var(--surface-2);
  overflow:hidden;cursor:pointer;
}
.detail-hero img{width:100%;height:100%;object-fit:cover;}
.detail-thumbs{
  display:flex;gap:6px;overflow-x:auto;padding:10px 16px;
  scrollbar-width:none;background:var(--surface);
  border-bottom:1px solid var(--border);
}
.detail-thumbs::-webkit-scrollbar{display:none;}
.detail-thumb{
  flex-shrink:0;width:60px;height:44px;border-radius:7px;
  overflow:hidden;border:2px solid transparent;cursor:pointer;
  transition:border-color 0.2s;
}
.detail-thumb.active{border-color:var(--red);}
.detail-thumb img{width:100%;height:100%;object-fit:cover;}
.detail-body{padding:20px 16px 28px;}
.detail-status-row{display:flex;align-items:center;gap:8px;margin-bottom:12px;}
.detail-name{
  font-family:var(--font-h);font-size:28px;font-weight:800;
  color:var(--white);line-height:1;margin-bottom:6px;
}
.detail-price{
  font-size:26px;font-weight:700;color:var(--white);margin-bottom:4px;
}
.detail-price-note{font-size:12px;color:var(--muted);margin-bottom:18px;}
.detail-desc{font-size:14px;color:var(--muted);line-height:1.65;margin-bottom:20px;}
.detail-specs{
  display:grid;grid-template-columns:1fr 1fr;gap:10px;
  margin-bottom:22px;
}
.spec-item{
  background:var(--surface-2);
  border:1px solid var(--border);
  border-radius:var(--r-sm);
  padding:10px 12px;
}
.spec-label{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:0.8px;margin-bottom:3px;}
.spec-value{font-size:13px;font-weight:600;color:var(--white);}
.detail-actions{display:flex;flex-direction:column;gap:10px;}
.detail-wa-btn{
  display:flex;align-items:center;justify-content:center;gap:9px;
  background:#25D366;color:white;
  font-size:15px;font-weight:700;
  padding:15px;border-radius:var(--r-md);
  transition:opacity 0.2s;
}
.detail-wa-btn:active{opacity:0.85;}
.detail-gallery-btn{
  display:flex;align-items:center;justify-content:center;gap:9px;
  background:var(--surface-2);color:var(--text);
  font-size:14px;font-weight:500;
  padding:13px;border-radius:var(--r-md);
  border:1px solid var(--border);
}
.detail-gallery-btn:active{background:var(--surface-3);}

/* GALER√çA MODAL */
.gallery-modal{
  display:none;position:fixed;inset:0;
  background:rgba(0,0,0,0.97);
  z-index:2000;
}
.gallery-modal.active{display:flex;flex-direction:column;}
.gallery-topbar{
  display:flex;align-items:center;justify-content:space-between;
  padding:14px 16px;
  flex-shrink:0;
}
.gallery-counter-text{font-size:14px;color:var(--muted);}
.gallery-close{
  width:36px;height:36px;border-radius:50%;
  background:var(--surface-2);color:var(--text);
  display:flex;align-items:center;justify-content:center;font-size:18px;
}
.gallery-main{
  flex:1;display:flex;align-items:center;justify-content:center;
  position:relative;overflow:hidden;
}
.gallery-slide{display:none;width:100%;height:100%;}
.gallery-slide.active{
  display:flex;align-items:center;justify-content:center;
  animation:fadeIn 0.2s ease;
}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.gallery-slide img{max-width:100%;max-height:100%;object-fit:contain;}
.gallery-btn{
  position:absolute;top:50%;transform:translateY(-50%);
  width:44px;height:44px;border-radius:50%;
  background:rgba(255,255,255,0.1);
  color:white;font-size:20px;
  display:flex;align-items:center;justify-content:center;
}
.gallery-btn-prev{left:10px;}
.gallery-btn-next{right:10px;}
.gallery-dots{
  display:flex;justify-content:center;gap:6px;
  padding:14px;flex-shrink:0;
}
.gallery-dot{
  width:7px;height:7px;border-radius:50%;
  background:var(--muted-2);transition:background 0.2s, transform 0.2s;
}
.gallery-dot.active{background:var(--red);transform:scale(1.3);}

/* NOTIFICACI√ìN */
.notif{
  position:fixed;bottom:90px;left:50%;transform:translateX(-50%);
  background:var(--surface-2);
  border:1px solid var(--border-hi);
  color:var(--text);
  padding:12px 20px;
  border-radius:var(--r-full);
  font-size:14px;font-weight:500;
  display:flex;align-items:center;gap:8px;
  z-index:9999;
  white-space:nowrap;
  animation:notifIn 0.3s ease;
  box-shadow:0 8px 24px rgba(0,0,0,0.4);
}
@keyframes notifIn{from{opacity:0;transform:translate(-50%,10px)}to{opacity:1;transform:translate(-50%,0)}}

/* ============================================
   RESPONSIVE ‚Äî en tablet y desktop 2 columnas
   ============================================ */
@media(min-width:600px){
  .vehicles-grid{
    display:grid;
    grid-template-columns:repeat(2,1fr);
  }
}
@media(min-width:900px){
  .vehicles-grid{
    grid-template-columns:repeat(3,1fr);
  }
  .hero-title{font-size:68px;}
  .wa-sticky{display:none !important;}
}
</style>
</head>
<body>

<!-- ========= TOPBAR ========= -->
<header class="topbar">
  <div class="topbar-logo"><span>Import</span> American Cars</div>
  <a class="topbar-wa" href="https://wa.me/56938654827?text=Hola%2C%20me%20interesa%20importar%20un%20veh√≠culo" target="_blank" rel="noopener">
    <i class="fab fa-whatsapp"></i> WhatsApp
  </a>
</header>

<!-- ========= HERO ========= -->
<section class="hero" id="home">
  <div class="hero-bg"></div>
  <div class="hero-gradient"></div>
  <div class="hero-content">
    <div class="hero-eyebrow"><i class="fas fa-shield-alt"></i> 142 veh√≠culos importados</div>
    <h1 class="hero-title">Camionetas USA<br>en <em>Arica</em></h1>
    <p class="hero-sub">Importamos directo desde Estados Unidos. T√∫ eliges, nosotros traemos. Reserva con el 10-30% del valor.</p>
    <div class="hero-stats">
      <div class="stat-pill" onclick="filterVehicles('stock');scrollToVehicles()">
        <div class="dot dot-green"></div>
        <strong id="heroStock">0</strong> En Stock
      </div>
      <div class="stat-pill" onclick="filterVehicles('transit');scrollToVehicles()">
        <div class="dot dot-blue"></div>
        <strong id="heroTransit">0</strong> En Tr√°nsito
      </div>
      <div class="stat-pill" onclick="filterVehicles('reserve');scrollToVehicles()">
        <div class="dot dot-orange"></div>
        <strong id="heroReserve">0</strong> Para Reservar
      </div>
    </div>
    <div class="hero-cta">
      <button class="btn-primary" onclick="scrollToVehicles()">
        <i class="fas fa-car"></i> Ver Veh√≠culos
      </button>
      <button class="btn-secondary" onclick="scrollToProceso()">
        <i class="fas fa-play"></i> C√≥mo funciona
      </button>
    </div>
  </div>
</section>

<!-- ========= TRUST BAR ========= -->
<div class="trust-bar">
  <div class="trust-bar-inner">
    <div class="trust-item"><i class="fas fa-map-marker-alt"></i><span><strong>Arica, Chile</strong></span></div>
    <div class="trust-item"><i class="fas fa-truck"></i><span>Importaci√≥n <strong>directa USA</strong></span></div>
    <div class="trust-item"><i class="fas fa-calendar-check"></i><span>Reserva desde <strong>10%</strong></span></div>
    <div class="trust-item"><i class="fas fa-tools"></i><span>Personalizaci√≥n <strong>incluida</strong></span></div>
    <div class="trust-item"><i class="fas fa-star"></i><span><strong>+142</strong> entregas</span></div>
  </div>
</div>

<!-- ========= VEH√çCULOS ========= -->
<section class="section" id="vehicles">
  <div class="section-label">Inventario</div>
  <h2 class="section-title">Veh√≠culos disponibles</h2>
  <p class="section-sub">Todos listos para reservar o en camino a Arica.</p>

  <!-- Filtros -->
  <div class="filter-scroll" id="filterBar">
    <button class="filter-chip active" data-filter="all" onclick="filterVehicles('all', this)">
      Todos
    </button>
    <button class="filter-chip" data-filter="stock" onclick="filterVehicles('stock', this)">
      <div class="fc-dot" style="background:var(--green)"></div> En Stock
    </button>
    <button class="filter-chip" data-filter="transit" onclick="filterVehicles('transit', this)">
      <div class="fc-dot" style="background:var(--blue)"></div> En Tr√°nsito
    </button>
    <button class="filter-chip" data-filter="reserve" onclick="filterVehicles('reserve', this)">
      <div class="fc-dot" style="background:var(--orange)"></div> Para Reservar
    </button>
  </div>

  <!-- Grid -->
  <div class="loading-state" id="loadingState">
    <div class="spin"></div>
    <span>Cargando veh√≠culos...</span>
  </div>
  <div class="empty-state" id="emptyState" style="display:none">
    <i class="fas fa-car"></i>
    <h3>Sin veh√≠culos disponibles</h3>
    <p>Intenta otro filtro o cont√°ctanos directamente</p>
  </div>
  <div class="vehicles-grid" id="vehiclesGrid" style="display:none"></div>
</section>

<!-- ========= PROCESO ========= -->
<section class="proceso-section" id="proceso">
  <div class="section-label">C√≥mo funciona</div>
  <h2 class="section-title">Del concesionario<br>a tu puerta</h2>
  <p class="section-sub" style="margin-bottom:32px">Mira c√≥mo importamos tu veh√≠culo y qu√© esperar en cada etapa.</p>

  <div class="proceso-steps">
    <div class="proceso-step">
      <div class="step-num">1</div>
      <div class="step-text">
        <h4>Eliges tu veh√≠culo</h4>
        <p>Ves el cat√°logo, te gusta uno y nos contactas por WhatsApp.</p>
      </div>
    </div>
    <div class="proceso-step">
      <div class="step-num">2</div>
      <div class="step-text">
        <h4>Reserva con 10-30%</h4>
        <p>Aseguras el veh√≠culo con una reserva. Sin reserva, no hay cupo.</p>
      </div>
    </div>
    <div class="proceso-step">
      <div class="step-num">3</div>
      <div class="step-text">
        <h4>Lo importamos</h4>
        <p>Compramos en USA, legalizamos, personalizamos si quieres.</p>
      </div>
    </div>
    <div class="proceso-step">
      <div class="step-num">4</div>
      <div class="step-text">
        <h4>Te entregamos en Arica</h4>
        <p>Tu camioneta lista, documentada, con garant√≠a de proceso.</p>
      </div>
    </div>
  </div>

  <!-- Video Instagram -->
  <div class="ig-video-wrap">
    <div class="ig-video-placeholder">
      <div class="ig-play-btn"><i class="fab fa-instagram"></i></div>
      <div class="ig-video-label">Mira el proceso real</div>
      <div class="ig-video-sub">Importaci√≥n paso a paso en nuestro Instagram</div>
    </div>
  </div>
  <a href="https://www.instagram.com/reel/C6ymBykukrm/" target="_blank" rel="noopener" class="ig-open-btn" onclick="trackEvent('click','Process','Instagram Video')">
    <i class="fab fa-instagram"></i> Ver proceso en Instagram
  </a>
</section>

<!-- ========= TESTIMONIOS ========= -->
<section class="section" style="padding-top:48px;padding-bottom:0">
  <div class="section-label">Clientes reales</div>
  <h2 class="section-title">Lo dicen ellos</h2>
  <p class="section-sub">Entregas verificadas. Clientes que confiaron en el proceso.</p>
</section>
<div style="padding:0 0 48px">
  <div class="testimonios-scroll">
    <div class="testimonio-card">
      <img src="https://res.cloudinary.com/df2gprqhp/image/upload/v1768677163/etgttozdi2qhd6tilxrv.jpg" alt="@renta_porter" class="test-avatar">
      <div class="test-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
      <p class="test-quote">"La personalizaci√≥n qued√≥ perfecta. Tope de l√≠nea, exactamente lo que ped√≠."</p>
      <div class="test-author">@renta_porter</div>
      <div class="test-vehicle">Silverado High Country</div>
    </div>
    <div class="testimonio-card">
      <img src="https://res.cloudinary.com/df2gprqhp/image/upload/v1768677162/qgqtze26yufabzmi5rbi.jpg" alt="Manuel" class="test-avatar">
      <div class="test-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
      <p class="test-quote">"Proceso transparente. Me mantuvieron informado en cada etapa. El auto qued√≥ espectacular."</p>
      <div class="test-author">Manuel</div>
      <div class="test-vehicle">Dodge Challenger</div>
    </div>
    <div class="testimonio-card">
      <img src="https://res.cloudinary.com/df2gprqhp/image/upload/v1768677163/nh1agnnh5jhw1ju38kef.jpg" alt="Iv√°n" class="test-avatar">
      <div class="test-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
      <p class="test-quote">"Excelente relaci√≥n precio-calidad. La personalizaci√≥n marca la diferencia frente a comprar local."</p>
      <div class="test-author">Iv√°n</div>
      <div class="test-vehicle">Dodge Ram</div>
    </div>
  </div>
</div>

<!-- ========= INSTAGRAM GRID ========= -->
<section class="section" style="padding-top:0;padding-bottom:48px">
  <div class="section-label">Instagram</div>
  <h2 class="section-title" style="margin-bottom:18px">@import_american_cars</h2>
  <div class="ig-grid">
    <a class="ig-post" href="https://www.instagram.com/import_american_cars" target="_blank" rel="noopener">
      <img src="https://res.cloudinary.com/df2gprqhp/image/upload/v1768676424/qbgz8hbqqjwdozqzf0f0.jpg" alt="Instagram 1" loading="lazy">
      <div class="ig-post-overlay"><i class="fab fa-instagram"></i></div>
    </a>
    <a class="ig-post" href="https://www.instagram.com/import_american_cars" target="_blank" rel="noopener">
      <img src="https://res.cloudinary.com/df2gprqhp/image/upload/v1768676522/iap8wm33cblfg6ofyc9r.jpg" alt="Instagram 2" loading="lazy">
      <div class="ig-post-overlay"><i class="fab fa-instagram"></i></div>
    </a>
    <a class="ig-post" href="https://www.instagram.com/import_american_cars" target="_blank" rel="noopener">
      <img src="https://res.cloudinary.com/df2gprqhp/image/upload/v1768676857/wgjdhwryqz6ji049mff3.jpg" alt="Instagram 3" loading="lazy">
      <div class="ig-post-overlay"><i class="fab fa-instagram"></i></div>
    </a>
    <a class="ig-post" href="https://www.instagram.com/import_american_cars" target="_blank" rel="noopener">
      <img src="https://res.cloudinary.com/df2gprqhp/image/upload/v1768676766/c3gtahfwy3sibrpz93fg.jpg" alt="Instagram 4" loading="lazy">
      <div class="ig-post-overlay"><i class="fab fa-instagram"></i></div>
    </a>
  </div>
</section>

<!-- ========= CTA FINAL ========= -->
<div class="final-cta">
  <h2>¬øListo para reservar<br>tu camioneta?</h2>
  <p>Escr√≠benos por WhatsApp. Te asesoramos y aseguramos tu veh√≠culo<br>con solo el 10-30% del valor.</p>
  <a class="final-cta-btn" href="https://wa.me/56938654827?text=Hola%2C%20quiero%20reservar%20un%20veh√≠culo.%20¬øPueden%20asesorarme?" target="_blank" rel="noopener" onclick="trackEvent('click','CTA','Final WhatsApp')">
    <i class="fab fa-whatsapp" style="font-size:20px"></i> Reservar por WhatsApp
  </a>
</div>

<!-- ========= FOOTER ========= -->
<footer class="footer">
  <div class="footer-logo"><span>Import</span> American Cars</div>
  <div class="footer-info">
    Alejandro Azolas 3048, Arica<br>
    +56 9 3865 4827<br>
    contacto@importamericancars.cl
  </div>
  <div class="footer-social">
    <a class="social-link" href="https://wa.me/56938654827" target="_blank" rel="noopener"><i class="fab fa-whatsapp"></i></a>
    <a class="social-link" href="https://www.instagram.com/import_american_cars" target="_blank" rel="noopener"><i class="fab fa-instagram"></i></a>
  </div>
</footer>

<!-- ========= WA STICKY ========= -->
<div class="wa-sticky" id="waSticky">
  <a class="wa-sticky-btn" href="https://wa.me/56938654827?text=Hola%2C%20me%20interesa%20importar%20un%20veh√≠culo" target="_blank" rel="noopener" onclick="trackEvent('click','Sticky','WhatsApp')">
    <i class="fab fa-whatsapp" style="font-size:20px"></i> Consultar / Reservar por WhatsApp
  </a>
</div>

<!-- ========= MODAL: DETALLE VEH√çCULO ========= -->
<div class="modal" id="detailModal">
  <div class="modal-overlay" onclick="closeDetail()"></div>
  <div class="modal-sheet" id="detailSheet">
    <button class="modal-close-btn" onclick="closeDetail()"><i class="fas fa-times"></i></button>
    <div id="detailContent"></div>
  </div>
</div>

<!-- ========= MODAL: GALER√çA ========= -->
<div class="gallery-modal" id="galleryModal">
  <div class="gallery-topbar">
    <span class="gallery-counter-text" id="galleryCounter">1 / 1</span>
    <button class="gallery-close" onclick="closeGallery()"><i class="fas fa-times"></i></button>
  </div>
  <div class="gallery-main">
    <div id="gallerySlides"></div>
    <button class="gallery-btn gallery-btn-prev" onclick="changeSlide(-1)">‚Äπ</button>
    <button class="gallery-btn gallery-btn-next" onclick="changeSlide(1)">‚Ä∫</button>
  </div>
  <div class="gallery-dots" id="galleryDots"></div>
</div>

<!-- ========= SCRIPTS ========= -->
<script src="js/config.js"></script>
<script src="js/api.js"></script>

<script>
/* =============================================
   APP PRINCIPAL
   ============================================= */

let allVehicles = [];
let currentFilter = 'all';
let currentGallery = [];
let currentSlideIndex = 0;
let selectedVehicle = null;

/* ‚Äî Inicializar ‚Äî */
document.addEventListener('DOMContentLoaded', async () => {
  vehicleAPI.init();
  await loadVehicles();
  setupWaSticky();
  handleDeepLink();
  trackEvent('page_loaded','Engagement','Home');
});

/* ‚Äî Cargar veh√≠culos ‚Äî */
async function loadVehicles() {
  showLoading(true);
  try {
    allVehicles = await vehicleAPI.getAllVehicles();
    updateHeroStats();
    renderVehicles(allVehicles);
  } catch(e) {
    console.error(e);
    showLoading(false);
    document.getElementById('emptyState').style.display = 'block';
  }
}

function updateHeroStats() {
  const s = allVehicles.filter(v=>v.status==='stock').length;
  const t = allVehicles.filter(v=>v.status==='transit').length;
  const r = allVehicles.filter(v=>v.status==='reserve').length;
  document.getElementById('heroStock').textContent = s;
  document.getElementById('heroTransit').textContent = t;
  document.getElementById('heroReserve').textContent = r;
}

/* ‚Äî Render tarjetas ‚Äî */
function renderVehicles(vehicles) {
  showLoading(false);
  const grid = document.getElementById('vehiclesGrid');
  const empty = document.getElementById('emptyState');

  if (!vehicles.length) {
    grid.style.display = 'none';
    empty.style.display = 'block';
    return;
  }
  empty.style.display = 'none';
  grid.style.display = '';

  const statusMap = {
    stock:   { cls:'vc-status-stock',   label:'En Stock Arica' },
    transit: { cls:'vc-status-transit', label:'En Tr√°nsito' },
    reserve: { cls:'vc-status-reserve', label:'Para Reservar' }
  };

  grid.innerHTML = vehicles.map(v => {
    const st = statusMap[v.status] || statusMap.reserve;
    const galleryCount = v.gallery ? v.gallery.length : 0;
    const hasSpecs = v.specifications && Object.values(v.specifications).some(x=>x);

    // Tags solo los m√°s √∫tiles en la card
    let tags = '';
    if (v.specifications?.motor) tags += `<div class="vc-tag"><i class="fas fa-cog" style="font-size:10px;color:var(--muted)"></i>${v.specifications.motor}</div>`;
    if (v.specifications?.traccion) tags += `<div class="vc-tag"><i class="fas fa-road" style="font-size:10px;color:var(--muted)"></i>${v.specifications.traccion}</div>`;
    if (v.location) tags += `<div class="vc-tag"><i class="fas fa-map-marker-alt" style="font-size:10px;color:var(--muted)"></i>${v.location}</div>`;

    const transit = v.status === 'transit' && v.transit_time
      ? `<div class="transit-pill"><i class="fas fa-shipping-fast"></i>Llega en aproximadamente <strong>${v.transit_time} d√≠as</strong></div>`
      : '';

    return `
    <div class="vehicle-card" id="vc-${v.id}">
      <div class="vc-image-wrap" onclick="openDetail('${v.id}')">
        <img src="${v.baseImage}" alt="${v.name}" loading="lazy">
        <div class="vc-status ${st.cls}">${st.label}</div>
        <button class="vc-share" onclick="event.stopPropagation();shareVehicle('${v.id}')" title="Compartir">
          <i class="fas fa-share-alt"></i>
        </button>
        ${galleryCount > 1 ? `<div class="vc-gallery-hint"><i class="fas fa-images"></i>${galleryCount} fotos</div>` : ''}
      </div>
      <div class="vc-body">
        <div class="vc-name">${v.name}</div>
        <div class="vc-price">$${formatPrice(v.price)} <span>CLP</span></div>
        ${transit}
        ${tags ? `<div class="vc-meta">${tags}</div>` : ''}
        <div class="vc-actions">
          <button class="vc-btn-main" onclick="contactVehicle('${v.id}')">
            <i class="fab fa-whatsapp"></i> Reservar
          </button>
          <button class="vc-btn-ghost" onclick="openDetail('${v.id}')">
            <i class="fas fa-info-circle"></i> Ver m√°s
          </button>
        </div>
      </div>
    </div>`;
  }).join('');
}

/* ‚Äî Filtros ‚Äî */
function filterVehicles(filter, btn) {
  currentFilter = filter;

  // actualizar chips activos
  document.querySelectorAll('.filter-chip').forEach(c => {
    c.classList.toggle('active', c.dataset.filter === filter);
  });

  const filtered = filter === 'all' ? allVehicles : allVehicles.filter(v => v.status === filter);
  renderVehicles(filtered);
  trackEvent('filter','Vehicles', filter);
}

function showLoading(show) {
  document.getElementById('loadingState').style.display = show ? 'flex' : 'none';
  if (show) {
    document.getElementById('vehiclesGrid').style.display = 'none';
    document.getElementById('emptyState').style.display = 'none';
  }
}

/* ‚Äî Navegaci√≥n ‚Äî */
function scrollToVehicles() {
  document.getElementById('vehicles').scrollIntoView({behavior:'smooth'});
}
function scrollToProceso() {
  document.getElementById('proceso').scrollIntoView({behavior:'smooth'});
}

/* ‚Äî WA Sticky ‚Äî */
function setupWaSticky() {
  const sticky = document.getElementById('waSticky');
  window.addEventListener('scroll', () => {
    sticky.classList.toggle('visible', window.scrollY > window.innerHeight * 0.6);
  }, {passive:true});
}

/* =============================================
   DETALLE VEH√çCULO
   ============================================= */
async function openDetail(vehicleId) {
  const modal = document.getElementById('detailModal');
  const content = document.getElementById('detailContent');

  try {
    const v = await vehicleAPI.getVehicle(vehicleId);
    selectedVehicle = v;
    trackEvent('view','Vehicle Detail', v.name);

    const statusMap = {
      stock:   { cls:'vc-status-stock',   label:'En Stock Arica' },
      transit: { cls:'vc-status-transit', label:'En Tr√°nsito' },
      reserve: { cls:'vc-status-reserve', label:'Para Reservar' }
    };
    const st = statusMap[v.status] || statusMap.reserve;

    const thumbsHtml = v.gallery && v.gallery.length > 1
      ? v.gallery.map((img, i) =>
          `<div class="detail-thumb ${i===0?'active':''}" onclick="switchDetailImg('${img}',this)">
             <img src="${img}" alt="foto ${i+1}" loading="lazy">
           </div>`
        ).join('')
      : '';

    const specsEntries = v.specifications
      ? Object.entries(v.specifications).filter(([,val]) => val)
      : [];
    const specsHtml = specsEntries.length
      ? `<div class="detail-specs">
          ${specsEntries.map(([k,val]) =>
            `<div class="spec-item">
               <div class="spec-label">${k}</div>
               <div class="spec-value">${val}</div>
             </div>`
          ).join('')}
         </div>`
      : '';

    const transit = v.status === 'transit' && v.transit_time
      ? `<div class="transit-pill" style="margin-bottom:14px"><i class="fas fa-shipping-fast"></i>Llega en aproximadamente <strong>${v.transit_time} d√≠as</strong></div>`
      : '';

    const reservaNote = `Reserva con el 10-30% del valor: desde $${formatPrice(Math.round(v.price*0.1))} CLP`;

    content.innerHTML = `
      <div class="detail-hero" onclick="openGallery('${v.id}')">
        <img src="${v.baseImage}" alt="${v.name}" id="detailMainImg">
      </div>
      ${thumbsHtml ? `<div class="detail-thumbs">${thumbsHtml}</div>` : ''}
      <div class="detail-body">
        <div class="detail-status-row">
          <div class="vc-status ${st.cls}" style="position:static">${st.label}</div>
        </div>
        <div class="detail-name">${v.name}</div>
        <div class="detail-price">$${formatPrice(v.price)} CLP</div>
        <div class="detail-price-note">${reservaNote}</div>
        ${transit}
        ${v.description ? `<p class="detail-desc">${v.description}</p>` : ''}
        ${specsHtml}
        <div class="detail-actions">
          <button class="detail-wa-btn" onclick="contactVehicle('${v.id}')">
            <i class="fab fa-whatsapp"></i> Quiero reservar este veh√≠culo
          </button>
          ${v.gallery && v.gallery.length > 1
            ? `<button class="detail-gallery-btn" onclick="openGallery('${v.id}')">
                 <i class="fas fa-images"></i> Ver todas las fotos (${v.gallery.length})
               </button>`
            : ''}
        </div>
      </div>`;

    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
  } catch(e) {
    console.error(e);
    showNotif('Error al cargar el veh√≠culo', 'error');
  }
}

function switchDetailImg(url, el) {
  document.getElementById('detailMainImg').src = url;
  document.querySelectorAll('.detail-thumb').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
}

function closeDetail() {
  document.getElementById('detailModal').classList.remove('active');
  document.body.style.overflow = '';
  selectedVehicle = null;
}

/* =============================================
   GALER√çA
   ============================================= */
async function openGallery(vehicleId) {
  try {
    const v = selectedVehicle && selectedVehicle.id === vehicleId
      ? selectedVehicle
      : await vehicleAPI.getVehicle(vehicleId);

    if (!v.gallery || !v.gallery.length) {
      showNotif('Sin im√°genes disponibles');
      return;
    }
    currentGallery = v.gallery;
    currentSlideIndex = 0;
    renderGallery();
    document.getElementById('galleryModal').classList.add('active');
    document.body.style.overflow = 'hidden';
    trackEvent('open','Gallery', v.name);
  } catch(e) { showNotif('Error al abrir galer√≠a', 'error'); }
}

function renderGallery() {
  const slides = document.getElementById('gallerySlides');
  const dots = document.getElementById('galleryDots');
  slides.innerHTML = currentGallery.map((img, i) =>
    `<div class="gallery-slide ${i===0?'active':''}" data-idx="${i}">
       <img src="${img}" alt="Foto ${i+1}">
     </div>`
  ).join('');
  dots.innerHTML = currentGallery.map((_,i) =>
    `<div class="gallery-dot ${i===0?'active':''}" onclick="goToSlide(${i})"></div>`
  ).join('');
  updateGalleryCounter();
}

function changeSlide(dir) {
  const total = currentGallery.length;
  currentSlideIndex = (currentSlideIndex + dir + total) % total;
  document.querySelectorAll('.gallery-slide').forEach((s,i) => s.classList.toggle('active', i===currentSlideIndex));
  document.querySelectorAll('.gallery-dot').forEach((d,i) => d.classList.toggle('active', i===currentSlideIndex));
  updateGalleryCounter();
}
function goToSlide(idx) { currentSlideIndex = idx - 1; changeSlide(1); }
function updateGalleryCounter() {
  document.getElementById('galleryCounter').textContent = `${currentSlideIndex+1} / ${currentGallery.length}`;
}
function closeGallery() {
  document.getElementById('galleryModal').classList.remove('active');
  document.body.style.overflow = '';
}

// Swipe galer√≠a
let gTouchStart = 0;
document.getElementById('galleryModal').addEventListener('touchstart', e => { gTouchStart = e.changedTouches[0].screenX; }, {passive:true});
document.getElementById('galleryModal').addEventListener('touchend', e => {
  const dx = e.changedTouches[0].screenX - gTouchStart;
  if (Math.abs(dx) > 44) changeSlide(dx < 0 ? 1 : -1);
}, {passive:true});

/* =============================================
   CONTACTO / COMPARTIR
   ============================================= */
function contactVehicle(vehicleId) {
  const v = allVehicles.find(x=>x.id===vehicleId) || selectedVehicle;
  if (!v) return;
  const msg = encodeURIComponent(
    `Hola, me interesa reservar:\n\nüöó ${v.name}\nüí∞ $${formatPrice(v.price)} CLP\nüìç Estado: ${v.status === 'stock' ? 'En Stock Arica' : v.status === 'transit' ? 'En Tr√°nsito' : 'Para Reservar'}\n\n¬øPueden darme m√°s informaci√≥n?`
  );
  trackEvent('contact','WhatsApp', v.name);
  window.open(`https://wa.me/56938654827?text=${msg}`, '_blank');
}

function shareVehicle(vehicleId) {
  const v = allVehicles.find(x=>x.id===vehicleId);
  if (!v) return;
  const url = `${location.origin}${location.pathname}?v=${vehicleId}`;
  const text = `Mira esta ${v.name} en Import American Cars Arica ‚Äî $${formatPrice(v.price)} CLP`;
  if (navigator.share) {
    navigator.share({title: v.name, text, url}).catch(()=>{});
  } else {
    window.open(`https://wa.me/?text=${encodeURIComponent(text+'\n'+url)}`, '_blank');
  }
  trackEvent('share','Vehicle', v.name);
}

/* ‚Äî Deep link ?v= ‚Äî */
function handleDeepLink() {
  const id = new URLSearchParams(location.search).get('v');
  if (!id) return;
  setTimeout(() => {
    const card = document.getElementById(`vc-${id}`);
    if (card) { card.scrollIntoView({behavior:'smooth', block:'center'}); }
    openDetail(id);
  }, 900);
}

/* ‚Äî Notificaci√≥n ‚Äî */
function showNotif(msg) {
  const n = document.createElement('div');
  n.className = 'notif';
  n.innerHTML = `<i class="fas fa-info-circle"></i>${msg}`;
  document.body.appendChild(n);
  setTimeout(() => n.remove(), 2800);
}

/* ‚Äî Teclado ‚Äî */
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') { closeDetail(); closeGallery(); }
  if (document.getElementById('galleryModal').classList.contains('active')) {
    if (e.key === 'ArrowLeft') changeSlide(-1);
    if (e.key === 'ArrowRight') changeSlide(1);
  }
});

/* ‚Äî GA helper ‚Äî */
function trackEvent(name, cat, label) {
  if (typeof gtag !== 'undefined') gtag('event', name, {event_category:cat, event_label:label});
}
</script>

</body>
</html>
