<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Import American Cars</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/components.css">
    
    <style>
    /* ========================================
       ADMIN PANEL - ESTILOS ADICIONALES
       ======================================== */
    
    body {
        background: var(--gray-50);
        padding-top: 60px;
    }
    
    /* LOGIN SCREEN */
    .login-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        background: var(--gray-50);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
    }
    
    .login-card {
        background: var(--white);
        border-radius: var(--radius-lg);
        padding: var(--space-4xl) var(--space-2xl);
        width: 90%;
        max-width: 400px;
        box-shadow: var(--shadow-lg);
        text-align: center;
    }
    
    .login-logo {
        font-size: var(--font-4xl);
        font-weight: var(--font-bold);
        margin-bottom: var(--space-sm);
        letter-spacing: var(--tracking-tight);
    }
    
    .login-logo .import-text {
        color: var(--import-red);
    }
    
    .login-subtitle {
        color: var(--gray-300);
        margin-bottom: var(--space-2xl);
        font-size: var(--font-lg);
    }
    
    /* ADMIN PANEL */
    .admin-header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-bottom: var(--border);
        padding: var(--space-md) var(--space-lg);
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: var(--z-header);
        height: 60px;
    }
    
    .admin-logo {
        font-size: var(--font-2xl);
        font-weight: var(--font-bold);
    }
    
    .admin-logo .import-text {
        color: var(--import-red);
    }
    
    .admin-user {
        display: flex;
        align-items: center;
        gap: var(--space-md);
    }
    
    .user-email {
        font-size: var(--font-sm);
        color: var(--gray-300);
    }
    
    .logout-btn {
        padding: 8px 16px;
        background: transparent;
        border: var(--border);
        border-radius: var(--radius-xl);
        color: var(--import-red);
        font-size: var(--font-sm);
        font-weight: var(--font-medium);
        cursor: pointer;
        transition: var(--transition-fast);
    }
    
    .logout-btn:hover {
        background: var(--import-red);
        color: var(--white);
        border-color: var(--import-red);
    }
    
    /* CONTAINER */
    .admin-container {
        max-width: var(--max-width-xl);
        margin: 0 auto;
        padding: var(--space-2xl) var(--space-lg);
    }
    
    /* STATS CARDS */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: var(--space-lg);
        margin-bottom: var(--space-2xl);
    }
    
    .stat-card {
        background: var(--white);
        border: var(--border);
        border-radius: var(--radius);
        padding: var(--space-xl);
        text-align: center;
        transition: var(--transition);
    }
    
    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow);
    }
    
    .stat-number {
        font-size: var(--font-5xl);
        font-weight: var(--font-bold);
        margin-bottom: var(--space-sm);
    }
    
    .stat-label {
        font-size: var(--font-sm);
        color: var(--gray-300);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    /* TABS */
    .admin-tabs {
        display: flex;
        gap: var(--space-sm);
        margin-bottom: var(--space-2xl);
        border-bottom: var(--border);
    }
    
    .admin-tab {
        padding: var(--space-md) var(--space-xl);
        background: transparent;
        border: none;
        border-bottom: 2px solid transparent;
        font-size: var(--font-md);
        font-weight: var(--font-medium);
        color: var(--gray-300);
        cursor: pointer;
        transition: var(--transition-fast);
    }
    
    .admin-tab:hover {
        color: var(--black);
    }
    
    .admin-tab.active {
        color: var(--import-red);
        border-bottom-color: var(--import-red);
    }
    
    .tab-content {
        display: none;
    }
    
    .tab-content.active {
        display: block;
        animation: fadeIn 0.3s ease-out;
    }
    
    /* VEHICLES TABLE */
    .vehicles-table {
        width: 100%;
        background: var(--white);
        border: var(--border);
        border-radius: var(--radius);
        overflow: hidden;
    }
    
    .vehicles-table thead {
        background: var(--gray-50);
    }
    
    .vehicles-table th {
        padding: var(--space-md) var(--space-lg);
        text-align: left;
        font-size: var(--font-sm);
        font-weight: var(--font-semibold);
        color: var(--gray-800);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .vehicles-table td {
        padding: var(--space-md) var(--space-lg);
        border-top: var(--border);
    }
    
    .vehicles-table tr:hover {
        background: var(--gray-50);
    }
    
    .table-image {
        width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: var(--radius-sm);
    }
    
    .action-buttons {
        display: flex;
        gap: var(--space-sm);
    }
    
    .btn-icon {
        width: 36px;
        height: 36px;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    /* FORM SECTIONS */
    .form-section {
        background: var(--white);
        border: var(--border);
        border-radius: var(--radius);
        padding: var(--space-2xl);
        margin-bottom: var(--space-xl);
    }
    
    .section-header {
        font-size: var(--font-xl);
        font-weight: var(--font-semibold);
        margin-bottom: var(--space-xl);
        padding-bottom: var(--space-md);
        border-bottom: var(--border);
    }
    
    .form-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: var(--space-lg);
    }
    
    /* IMAGE PREVIEW */
    .main-badge {
        position: absolute;
        bottom: 8px;
        left: 8px;
        background: var(--import-red);
        color: var(--white);
        padding: 4px 10px;
        border-radius: var(--radius-sm);
        font-size: var(--font-xs);
        font-weight: var(--font-semibold);
    }
    
    /* FORM ACTIONS */
    .form-actions {
        display: flex;
        gap: var(--space-md);
        margin-top: var(--space-2xl);
    }
    
    .form-actions .button {
        flex: 1;
    }
    
    /* HIDDEN */
    .hidden {
        display: none !important;
    }
    
    /* RESPONSIVE */
    @media (max-width: 768px) {
        .admin-container {
            padding: var(--space-lg) var(--space-md);
        }
        
        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .admin-tabs {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .admin-tab {
            white-space: nowrap;
        }
        
        .vehicles-table {
            font-size: var(--font-sm);
        }
        
        .vehicles-table th,
        .vehicles-table td {
            padding: var(--space-sm) var(--space-md);
        }
        
        .form-section {
            padding: var(--space-lg);
        }
        
        .form-row {
            grid-template-columns: 1fr;
        }
        
        .form-actions {
            flex-direction: column;
        }
    }
    </style>
</head>
<body>
    <!-- ================================
         LOGIN SCREEN
         ================================ -->
    <div id="loginScreen" class="login-screen hidden">
        <div class="login-card">
            <div class="login-logo">
                <span class="import-text">Import</span> American Cars
            </div>
            <div class="login-subtitle">Panel de Administración</div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input 
                        type="email" 
                        id="loginEmail" 
                        class="form-input" 
                        placeholder="admin@importcars.cl" 
                        required 
                        autocomplete="email"
                    >
                </div>
                
                <div class="form-group">
                    <label class="form-label">Contraseña</label>
                    <input 
                        type="password" 
                        id="loginPassword" 
                        class="form-input" 
                        placeholder="••••••••" 
                        required 
                        autocomplete="current-password"
                    >
                </div>
                
                <button type="submit" class="button" style="width: 100%;">
                    <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                </button>
            </form>
        </div>
    </div>

    <!-- ================================
         ADMIN PANEL
         ================================ -->
    <div id="adminPanel" class="hidden">
        <!-- Header -->
        <header class="admin-header">
            <div class="admin-logo">
                <span class="import-text">Import</span> Admin
            </div>
            <div class="admin-user">
                <div class="user-email" id="userEmail"></div>
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Salir
                </button>
            </div>
        </header>

        <!-- Main Container -->
        <div class="admin-container">
            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" style="color: var(--green);" id="adminStockCount">0</div>
                    <div class="stat-label">En Stock</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: var(--blue);" id="adminTransitCount">0</div>
                    <div class="stat-label">En Tránsito</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: var(--orange);" id="adminReserveCount">0</div>
                    <div class="stat-label">Para Reservar</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="adminTotalCount">0</div>
                    <div class="stat-label">Total</div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="admin-tabs">
                <button class="admin-tab active" onclick="switchToTab('vehicles')">
                    <i class="fas fa-list"></i> Vehículos
                </button>
                <button class="admin-tab" onclick="switchToTab('add')">
                    <i class="fas fa-plus-circle"></i> Agregar Vehículo
                </button>
            </div>

            <!-- Tab Content: Vehículos -->
            <div id="vehiclesTab" class="tab-content active">
                <div id="vehiclesTableContainer">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <p>Cargando vehículos...</p>
                    </div>
                </div>
            </div>

            <!-- Tab Content: Agregar/Editar -->
            <div id="addTab" class="tab-content">
                <form id="vehicleForm">
                    <!-- Información Básica -->
                    <div class="form-section">
                        <h3 class="section-header" id="formTitle">Agregar Vehículo</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Nombre del Vehículo *</label>
                                <input 
                                    type="text" 
                                    name="name" 
                                    class="form-input" 
                                    placeholder="Chevrolet Silverado 1500 LTZ 2021" 
                                    required
                                >
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Precio (CLP) *</label>
                                <input 
                                    type="number" 
                                    name="price" 
                                    class="form-input" 
                                    placeholder="32900000" 
                                    required
                                >
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Estado *</label>
                                <select name="status" class="form-select" required>
                                    <option value="stock">En Stock Arica</option>
                                    <option value="transit">En Tránsito</option>
                                    <option value="reserve">Para Reservar</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Ubicación</label>
                                <input 
                                    type="text" 
                                    name="location" 
                                    class="form-input" 
                                    placeholder="Arica, Chile"
                                >
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Tipo</label>
                                <input 
                                    type="text" 
                                    name="type" 
                                    class="form-input" 
                                    placeholder="silverado, ram, f150"
                                >
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">ETA / Disponibilidad</label>
                                <input 
                                    type="text" 
                                    name="eta" 
                                    class="form-input" 
                                    placeholder="Disponible inmediato"
                                >
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Descripción</label>
                            <textarea 
                                name="description" 
                                class="form-textarea" 
                                placeholder="5.3L V8 • 4x4 • Crew Cab • Cuero • Pantalla Táctil"
                            ></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Días en Tránsito (si aplica)</label>
                                <input 
                                    type="number" 
                                    name="transit_time" 
                                    class="form-input" 
                                    placeholder="15"
                                >
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Video ID (YouTube)</label>
                                <input 
                                    type="text" 
                                    name="video_id" 
                                    class="form-input" 
                                    placeholder="M7FIvfx5J10"
                                >
                            </div>
                        </div>
                    </div>

                    <!-- Especificaciones Técnicas -->
                    <div class="form-section">
                        <h3 class="section-header">Especificaciones Técnicas</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Motor</label>
                                <input 
                                    type="text" 
                                    name="motor" 
                                    class="form-input" 
                                    placeholder="5.3L V8 EcoTec3"
                                >
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Potencia</label>
                                <input 
                                    type="text" 
                                    name="potencia" 
                                    class="form-input" 
                                    placeholder="355 HP @ 5600 RPM"
                                >
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Torque</label>
                                <input 
                                    type="text" 
                                    name="torque" 
                                    class="form-input" 
                                    placeholder="383 lb-ft @ 4100 RPM"
                                >
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Transmisión</label>
                                <input 
                                    type="text" 
                                    name="transmision" 
                                    class="form-input" 
                                    placeholder="Automática 10 velocidades"
                                >
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Tracción</label>
                                <input 
                                    type="text" 
                                    name="traccion" 
                                    class="form-input" 
                                    placeholder="4x4"
                                >
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Combustible</label>
                                <input 
                                    type="text" 
                                    name="combustible" 
                                    class="form-input" 
                                    placeholder="Gasolina"
                                >
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Consumo</label>
                                <input 
                                    type="text" 
                                    name="consumo" 
                                    class="form-input" 
                                    placeholder="12.7 L/100km"
                                >
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Capacidad</label>
                                <input 
                                    type="text" 
                                    name="capacidad" 
                                    class="form-input" 
                                    placeholder="6 pasajeros"
                                >
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Color</label>
                                <input 
                                    type="text" 
                                    name="color" 
                                    class="form-input" 
                                    placeholder="Gris Summit White"
                                >
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Kilometraje</label>
                                <input 
                                    type="text" 
                                    name="kilometraje" 
                                    class="form-input" 
                                    placeholder="45,000 km"
                                >
                            </div>
                        </div>
                    </div>

                    <!-- Imágenes -->
                    <div class="form-section">
                        <h3 class="section-header">Imágenes (Máximo 10)</h3>
                        
                        <div class="image-upload-area" id="imageUploadArea">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <div class="upload-text">
                                Click para seleccionar imágenes o arrastra aquí
                            </div>
                            <div class="upload-hint">
                                La primera imagen será la principal • Formatos: JPG, PNG, WEBP • Máx 10MB por imagen
                            </div>
                            <input 
                                type="file" 
                                id="imageInput" 
                                multiple 
                                accept="image/*" 
                                style="display: none;"
                            >
                        </div>
                        
                        <div class="image-preview" id="imagePreview"></div>
                    </div>

                    <!-- Botones de Acción -->
                    <div class="form-actions">
                        <button type="submit" class="button" id="submitBtn">
                            <i class="fas fa-save"></i> Guardar Vehículo
                        </button>
                        <button type="button" class="button button-outline" onclick="cancelForm()">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/admin.js"></script>
</body>
</html>
